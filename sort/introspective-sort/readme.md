# 内省式排序（Introspective Sort）

快速排序在大多数情况下效率最高，应当是首选的排序算法。但是它在某些情况下，会掉入陷阱，复杂度恶化到 。
堆排序虽然在大多数情况下不如快速排序效率高，但在所有的情况下复杂度都是nlogn。因此若能检测到快速排序掉入陷阱，则堆排序会是一个很好的补充。
插入排序虽然复杂度虽然只能达到 ，但若能已知「几乎已经排好序」，切换到插入排序的效率又要比快速排序和堆排序高出不少，能做到 。

快速排序调入陷阱，意味着在递归时快速排序算法会连续多次选中带分割区间的最值元素，从而导致多次「无效」分割，进而导致递归层数快速增加。因此，我们可以设置一个阈值；一旦递归深度超出该阈值，则认为快速排序掉入陷阱了并切换到堆排序算法。

快速排序在理想状态下，应当递归约logn次。因此，我们可以说，如果递归深度明显大于logn，快速排序就掉进陷阱了。于是，我们可以将该阈值设置为logn的某一倍数，比如 ；一旦递归深度超过2logn，就从快速排序切换到堆排序。

## 排序思路

当元素数目小于等于 12 时进行插入排序
当元素数目大于 12 同时阈值为 0 时进行堆排序
当元素数目大于 12 同时阈值不为 0 时进行快速排序，返回初次排序的分界值后重新进行元素数目判断排序
